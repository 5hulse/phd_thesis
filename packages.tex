\usepackage{amsmath}
\allowdisplaybreaks[1]
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\IFT}{IFT}
\DeclareMathOperator{\range}{range}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\Var}{Var}
\DeclareMathOperator{\SNR}{SNR}
\DeclareMathOperator{\SVD}{SVD}
\DeclareMathOperator{\EIGENVALUES}{EIGENVALUES}

\usepackage{amsthm}
\newtheorem{remark}{Remark}
\newtheorem{definition}{Definition}
\newtheorem{theorem}{Theorem}

\usepackage{datetime}
\dmyyyydate

\usepackage{nicefrac}
\usepackage{upgreek} % For upright capital delta
\usepackage{textgreek} % For Greek symbols in text mode
\usepackage{MnSymbol} % For conditional independence symbol
\usepackage{chemformula}
\usepackage{pdfpages} % to insert NMR-EsPy walkthrough
\usepackage{lscape} % for CUPID metrics table
\usepackage{rotating} % for sidewaysfigure environment
\usepackage{subfig} % for GUI figure: spans 2 pages
\usepackage{booktabs,longtable}  % for tables
\usepackage{graphicx}
\graphicspath{{figures/}}

%%% Nomenclature: see text/front/nomenclature.tex
\usepackage{nomencl}
\renewcommand{\nompreamble}{\pagestyle{plain}}
\makenomenclature
\usepackage{ifthen}

%%% Unit configuration
\usepackage[
     print-unity-mantissa=false,%
]{siunitx}
\DeclareSIUnit \gauss {G}
\DeclareSIUnit \molar {M}
\DeclareSIUnit \partspermillion {ppm}
\sisetup{detect-all,input-digits=0123456789\mitpi}

\usepackage[printonlyused]{acronym}  % See text/front/acrons.tex

%%% Circled numbers
\usepackage{tikz}
\newcommand*\circled[1]{{\scriptsize\tikz[baseline=(char.base)]{
            \node[shape=circle,draw,inner sep=1pt] (char) {#1};}}}

%%% Hyperlink configuration
\usepackage{hyperref}
\definecolor{linkblue}{HTML}{0000ee}
\hypersetup{
    colorlinks=true,
    linkcolor=black,
    urlcolor=linkblue,
    citecolor=black,
}
\def\UrlBreaks{\do\/\do-\do.}

%%% Algorithm configuration
\usepackage{algorithm,algpseudocode}
\numberwithin{algorithm}{chapter}
\makeatletter
\algrenewcommand\ALG@beginalgorithmic{\footnotesize}
\makeatother
\captionsetup[algorithm]{%
    font=singlespacing,%
    labelfont={small,bf,sc},%
    textfont=small,%
}

%%% Internal reference configuration
\usepackage[capitalize,noabbrev]{cleveref}
\crefformat{equation}{Equation~#2#1#3}
\Crefformat{equation}{Equation~#2#1#3}
\crefrangeformat{equation}{Equations~(#3#1#4) to~(#5#2#6)}
\Crefrangeformat{equation}{Equations~(#3#1#4) to~(#5#2#6)}
\crefmultiformat{equation}{Equations~#2#1#3}%
{ and~#2#1#3}{, #2#1#3}{ and~#2#1#3}
\Crefmultiformat{equation}{Equations~#2#1#3}%
{ and~#2#1#3}{, #2#1#3}{ and~#2#1#3}

\makeatletter
\crefformat{tcb@cnt@mylisting}{Listing~#2#1#3}
\Crefformat{tcb@cnt@mylisting}{Listing~#2#1#3}
\crefrangeformat{tcb@cnt@mylisting}{Listings~(#3#1#4) to~(#5#2#6)}
\Crefrangeformat{tcb@cnt@mylisting}{Listings~(#3#1#4) to~(#5#2#6)}
\crefmultiformat{tcb@cnt@mylisting}{Listings~#2#1#3}%
{ and~#2#1#3}{, #2#1#3}{ and~#2#1#3}
\Crefmultiformat{tcb@cnt@mylisting}{Listings~#2#1#3}%
{ and~#2#1#3}{, #2#1#3}{ and~#2#1#3}
\makeatother

%%% Bibliography configuration
\usepackage[
    doi=false,
    isbn=false,
    url=false,
    eprint=false,
    sorting=none,
    style=numeric-comp,
    giveninits=true,
    maxbibnames=20,
]{biblatex}
\DeclareDelimFormat{postnotedelim}{\addcolon\space}
\DeclareFieldFormat{postnote}{\mknormrange{#1}}
\usepackage{bibentry}  % To insert references in main text

%%% Code listing configuration
\usepackage{minted,tcolorbox,listings}
\tcbuselibrary{listings,minted,breakable,skins}
\definecolor{code_bg}{HTML}{f8f8f8}
\renewcommand{\theFancyVerbLine}{\ttfamily\small
    \textcolor{black}{\arabic{FancyVerbLine}}}
\newtcbinputlisting[
    list inside=mylist,
    auto counter,
    number within=chapter,
]{\mylisting}[5]{%
    listing only,
    minted language={#1},
    listing file={#2},
    list entry={\protect\numberline{\thetcbcounter} #3},
    title={{\small\textbf{\textsc{Code Listing \thetcbcounter:}} #4}},
    label={#5},
    minted style=friendly,
    boxrule=1pt,
    code={\setlength{\parskip}{0.05in}\singlespacing},
    colframe=black,
    colback=code_bg,
    coltitle=black,
    colbacktitle=white,
    titlerule=0mm,
    arc=0pt,
    outer arc=0pt,
    enhanced,
    breakable,
    top=0pt,
    bottom=0pt,
    width=\textwidth,
    minted options = {
        linenos,
        tabsize=0,
        breaklines,
        autogobble=false,
        mathescape,
        escapeinside=!!,
        numbersep=2.2mm,
        xleftmargin=3mm
    },
    overlay = {
    \begin{tcbclipinterior}
        \fill[code_bg] (frame.south west) rectangle ([xshift=5mm]frame.north west);
    \end{tcbclipinterior}
    }
}

