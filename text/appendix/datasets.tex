\chapter{Information on Datasets}
\label{chap:datasets}

\section{Simulated datasets}
\label{sec:simulated-datasets}
Many of the simulated datasets presented in this work were generated using the
\textsc{Spinach} \textsc{Matlab}\textregistered\ package\cite{Hogben2011}.
In each case, the dataset was generated via a call to the \texttt{new\_spinach}
method associated with the relevant \texttt{Estimator} object in \ac{EsPy}.
\texttt{new\_spinach} works by instantiating a \href{https://www.mathworks.com/help/matlab/matlab-engine-for-python.html}{\textsc{Matlab}
engine} from \textsc{Python}, which then runs a \textsc{\textsc{Spinach}} simulation of the relevant
experiment with the specifications provided. The \ac{FID} generated is then
stored within in a new \texttt{Estimator} object.

\subsection{\acs{2DJ}}
The simulated datasets for the ``Four multiplets'' and Sucrose results in
Sections \ref{subsec:four-mp} and \ref{subsec:sucrose-cupid} were generated
using \ac{EsPy}'s \mintinline{python}{Estimator2DJ.new_spinach} method, with
key parameters supplied to the simulation provided by Table
\ref{tab:spinach-jres-params}.

\input{text/generated/cupid_spinach_parameters}

A \ac{2DJ} pulse sequence simulation does not ship with \textsc{Spinach}.
Therefore, an in-house one was written, which is as follows:

\mylisting{matlab}{code_listings/jres.m}{Hello}{Hello}{lst:jres-spinach}

The chemical shifts and couplings for sucrose were extracted from a
\textsc{Gaussian}\cite{Gaussian03} logfile which ships with \textsc{Spinach} at
the path \path{SPINACHROOT/examples/standard_systems/sucrose.log}.
Isotropic chemical shifts were determined for each spin $i$ via
\begin{equation}
    \delta_i = \frac{\Tr \left( \symbf{\sigma}_i \right)}{3},
\end{equation}
where $\symbf{\sigma}_i \in \mathbb{R}^{3 \times 3}$ is the computed chemical
shift tensor of spin $i$.

The chemical shifts and couplings associated with the ``four multiplets''
datasets were generated as described in the main text.

\subsection{Inversion recovery}
As described in the Spinach documentation\cite{SpinachDocs}, longitudinal
spin states are assigned the rate $\nicefrac{1}{T_1}$ and transverse states
are assigned the rate $\nicefrac{1}{T_2}$. Multi-spin states are assigned
rates which are the summation of each spin's relevant rate.


\subsection{\textsc{\textsc{Spinach}} Simulations}
Table \ref{tab:shifts_and_couplings} provides a specification of the chemical
shifts and scalar couplings that made up the spin systems used to construct
simulated data with \textsc{Spinach}. Tables \ref{tab:spinach-jres-params} and
\ref{tab:spinach-invrec-params} specify key parameters used in each
\ac{2DJ} and inversion recovery simulation, respectively.

\subsubsection{Spin Systems}
\paragraph{Sucrose}
The chemical shifts and couplings for sucrose were extracted from a
\textsc{Gaussian}\cite{Gaussian03} logfile which ships with \textsc{Spinach} at
the path \path{SPINACHROOT/examples/standard_systems/sucrose.log}.
Isotropic chemical shifts were determined for each spin $i$ via
\begin{equation}
    \delta_i = \frac{\Tr \left( \symbf{\sigma}_i \right)}{3},
\end{equation}
where $\symbf{\sigma}_i \in \mathbb{R}^{3 \times 3}$ is the computed chemical
shift tensor of spin $i$.

\paragraph{Strychnine}
The strychnine spin system was derived from
the \textsc{Spinach} function \texttt{<SPINACHROOT>/etc/strychnine.m}, which returns a
spin system specification using chemical shifts and scalar couplings
from\cite[Appendix 5]{Berger2004}, and atomic coordinates
from\cite[Supplementary Material]{Butts2011}. To determine $T_1$ and  $T_2$
values for each spin, the relaxation superoperator $\symbf{R}$ was
constructed according to Redfield theory, under the assumption
that the molecule was undergoing spherical isotropic rotation with a rotational
correlation time of \qty{200}{\pico\second}, in a magnetic field of
\qty{700}{\mega\hertz}. Individual $T_1$s and $T_2$s were then extracted using
\begin{subequations}
    \begin{gather}
        T_{(1/2),i} = \frac{1}{R_{(1/2),i}}, \\
        R_{1,i} = - \Re \left(
            \symbf{l}_{z,i}^{\dagger} \symbf{R} \symbf{l}_{z,i}^{\vphantom{\dagger}}
            \right),\\
        R_{2,i} = - \Re \left(
            \symbf{l}_{+,i}^{\dagger} \symbf{R} \symbf{l}_{+,i}^{\vphantom{\dagger}}
            \right),
    \end{gather}
\end{subequations}
where $\symbf{l}_{z,i}^{\vphantom{\dagger}}$ is the state vector of the
Hilbert-space operator $\hat{L}_z$ for spin $i$, and
$\symbf{l}_{+,i}^{\vphantom{\dagger}}$ is the corresponding vector for the
$\hat{L}_+$ operator.

\input{text/generated/shifts_and_couplings}
\note{Table of spinach experiment parameters}
\note{Description of 2DJ and Invrec simulations (i.e. relaxation model used, approximations to basis used etc.}


\section{Experimental datasets}

\subsection{Structures}

\begin{figure}[h!]
    \centering
    \includegraphics{structures/structures_final.pdf}
    \caption[
        The molecular structures of species giving rise to the experimental
        \acs{NMR} datasets considered in this work.
    ]{
        The molecular structures of species giving rise to the experimental
        \acs{NMR} datasets considered in this work.
        \textbf{a.} Quinine,
        \textbf{b.} Dexamethasone,
        \textbf{c.} Camphor,
        \textbf{d.} 17\textbeta-estradiol,
        \textbf{e.} Andrographolide.
        Proton environments giving rise to signals which are considered in this
        work are denoted with bracketed alphabetical characters. Non-bracketed
        alphabetical characters denote chemical symbols. \ch{Me} denotes the methyl
        group, equivalent to \ch{CH3}.
        \note{
            TODO: check assignments (esp. estradiol). If more structures need
            adding, edit the ChemDraw file on Chive called
            \path{simon_stuff/thesis_structures.cdxml}. Use EB-Garamond for
            atom labels. One a structure is made, scale to 75\% of original
            size, and set font to 7pt. Then in inkscape, rescale this by
            multiplying by 0.8.
        }
    }
    \label{fig:structures}
\end{figure}


\subsection{Diffusion datasets}
The andrographolide diffusion dataset (Figure \ref{fig:andrographolide-dosy})
was acquired using the one-shot \ac{DOSY} pulse sequence\cite{Pelta2002}
(version 1.0c, published on \formatdate{27}{03}{2012}), accessible via the webpage
\url{https://www.nmr.chemistry.manchester.ac.uk/?q=node/264}. The pulse
sequence is displayed in Figure \ref{fig:oneshot-dosy}.

\begin{figure}
    \centering
    \includegraphics{oneshot_dosy_pulse_sequence/oneshot_dosy_pulse_sequence.pdf}
    \caption[
        Oneshot \acs{DOSY} pulse sequence used for the acquisition of
        andrographolide data.
    ]{
        Oneshot \ac{DOSY} pulse sequence used for the acquisition of
        andrographolide data (Figure \ref{fig:andrographolide-dosy}). All
        delays are included, though they are not to scale.
        Delays:
        $d_1$ (relaxation delay): \qty{1.5}{\second},
        $d_{16}$ (gradient recovery delay): \qty{200}{\micro\second},
        $d_{20}$ (diffusion time, equivalent to $\Delta$): \qty{0.1}{\second}.
        Hard pulses had a power of \qty{24}{\watt},
        with the duration of the $\nicefrac{\pi}{2}$ pulse being
        \qty{12}{\micro\second}.
        Diffusion encoding gradients had a smoothed square profile
        (\texttt{SMSQ10.100}), a duration of \qty{1}{\milli\second}, and had
        strengths related to the values $g_1$ and $\alpha = 0.2$.
        $g_1$ was varied across increments, with the values used
        being (\unit{\gauss \per \centi \meter}):
        6.270,
        12.470,
        16.483,
        19.695,
        22.451,
        24.905,
        27.137,
        29.200,
        31.126,
        32.939,
        34.658,
        36.296,
        37.862,
        39.367,
        40.816,
        42.215,
        43.570,
        44.883,
        46.159,
        47.401.
        Spoiler gradients had the same \texttt{SMSQ10.100} profile, had a
        duration of \qty{600}{\micro\second}, and a strength which was 75\% of
        $g_1$.
        The phase cycling scheme used was:
        $\Phi_1: 2 \times (\ang{0}, \ang{180})$;
        $\Phi_2: 4 \times \ang{0}$;
        $\Phi_3: 4 \times \ang{0}$;
        $\Phi_4: 2 \times \ang{0}, 2 \times \ang{180}$;
        $\Phi_5: 4 \times \ang{0}$;
        $\Phi_{\text{rx}}: \ang{0}, \ang{180}, \ang{180}, \ang{0}$.
    }
    \label{fig:oneshot-dosy}
\end{figure}

The glucose/valine/threonine diffusion dataset (Figure \ref{fig:gluc_val_thre})
was acquired using Bruker's \texttt{ledbpgp2s} pulse sequence (version 1.9, published on
\formatdate{19}{02}{2011}). This is a stimulated echo pulse sequence, featuring
bipolar gradients and a \ac{LED} component\cite{Wu1995}. The pulse sequence is
displayed in Figure \ref{fig:ledbpgp2s}.
\begin{figure}
    \centering
    \includegraphics{ledbpgp_pulse_sequence/ledbpgp_pulse_sequence.pdf}
    \caption[
        Pulse sequence used for the acquisition of glucose/threonine/valine
        diffusion data.
    ]{
        Pulse sequence used for the acquisition of glucose/threonine/valine
        diffusion data (Figure \ref{fig:gluc_val_thre}). All
        delays are included, though they are not to scale.
        Delays:
        $d_1$ (relaxation delay): \qty{6}{\second},
        $d_{16}$ (gradient recovery delay): \qty{200}{\micro\second},
        $d_{20}$ (diffusion time, equivalent to $\Delta$): \qty{0.1}{\second},
        $d_{21}$ (eddy-current delay): \qty{5}{\milli\second}.
        Hard pulses had a power of \qty{18.204}{\watt},
        with the duration of the $\nicefrac{\pi}{2}$ pulse being
        \qty{10}{\micro\second}.
        All gradients had a smoothed square profile
        (\texttt{SMSQ10.100}).
        Gradients for diffusion encoding had a duration of
        \qty{1}{\milli\second}, with strength $g_6$ varied across increments,
        with the values used being (\unit{\gauss \per \centi \meter}):
        4.500,
        12.728,
        17.428,
        21.107,
        24.233,
        27.000,
        29.508,
        31.820,
        33.974,
        36.000.
        Spoiler gradients had a duration of \qty{600}{\micro\second}. The
        gradients had the relative strengths $g_7=-0.1713g_6$ and
        $g_8=-0.1317g_6$.
        The phase cycling scheme used was:
        $\Phi_1: 32 \times \ang{0}$;
        $\Phi_2: 8 \times (2 \times \ang{0}, 2 \times \ang{180})$;
        $\Phi_3: 2 \times (4 \times \ang{0}, 4 \times \ang{180}, 4 \times \ang{90}, 4 \times \ang{270})$;
        $\Phi_4: 2 \times (2 \times (\ang{0}, \ang{180}), 2 \times (\ang{180}, \ang{0}), 2 \times (\ang{90}, \ang{270}), 2 \times (\ang{270}, \ang{90})$;
        $\Phi_5: 2 \times (4 \times \ang{0}, 4 \times \ang{180}, 4 \times \ang{90}, 4 \times \ang{270})$;
        $\Phi_{\text{rx}}: 2 \times (\ang{0}, \ang{180}, \ang{180}, \ang{0}, \ang{180}, \ang{0} \ang{0}, \ang{180},
        \ang{270}, \ang{90}, \ang{90}, \ang{270}, \ang{90}, \ang{270}, \ang{270}, \ang{90})$.
    }
    \label{fig:ledbpgp2s}
\end{figure}

\subsection{\acs{2DJ} datasets}
\label{subsec:cupid-experimental}

The 2D J-Resolved datasets presented were acquired using Bruker's
\texttt{jresqf} pulse sequence (version 1.7, released
\formatdate{31}{01}{2012}). This pulse sequence comprises
 $\nicefrac{\pi}{2}(\Phi_1) \rightarrow \nicefrac{\tone}{2} \rightarrow
\pi(\Phi_{2}) \rightarrow \nicefrac{\tone}{2} \rightarrow \ttwo(\Phi_{\text{rx}})$, with
the EXORCYCLE phase-cycling scheme\cite[Section 11.6]{Keeler2010}:
\begin{equation*}
    \begin{array}{lllll}
        \Phi_{1}: & \ang{0} & \ang{0} & \ang{0} & \ang{0} \\
        \Phi_{2}: & \ang{0} & \ang{90} & \ang{180} & \ang{270} \\
        \Phi_{\text{rx}}: & \ang{0} & \ang{180} & \ang{0} & \ang{180}
    \end{array}
\end{equation*}
Key experiment parameters are provided in Table \ref{tab:jres_params}.
\input{text/generated/jres_params}

\subsection{\acs{PSYCHE} datasets}
The pulse sequence used for the acquisition of the estradiol \ac{PSYCHE}
spectrum (Figure \ref{fig:estradiol-cupid}) is presented in Figure
\ref{fig:psyche}, where
pulses, gradients, and delays are described in detail. Equivalent parameters
were used for the basic setup as the estradiol 2DJ experiment, given in Table
\ref{tab:jres_params}.

The pure shift spectrum of dexamethasone (Figure
\ref{fig:dexamethasone-cupid}.a) was acquired using a \ac{TSE-PSYCHE}
experiment (Figure \ref{fig:tse_psyche}). The pulse sequence file
\texttt{UoM\_1d\_if\_tsepsyche\_ts4x} can be obtained via the link
\url{https://research.manchester.ac.uk/en/datasets/manchester-pure-shift-nmr-workshop-bruker-software}.

\begin{figure}
    \centering
    \includegraphics{psyche_pulse_sequence/psyche_pulse_sequence.pdf}
    \caption[
        \acs{PSYCHE} pulse sequence used for the acquisition of estradiol data.
    ]{
        \acs{PSYCHE} pulse sequence used for the acquisition of estradiol data. All
        delays are included, though they are not to scale.
        Delays:
        $d_1$ (relaxation delay): \qty{1}{\second},
        $d_{16}$: (gradient recovery delay): \qty{200}{\micro\second},
        $d_{18}$: \qty{200}{\micro\second},
        $d_{19}$: \qty{1}{\milli\second},
        $\tau_a$: \qty{1.3}{\milli\second},
        $\tau_d$: \qty{18.9}{\milli\second}.
        The \ac{PSYCHE} element featured two saltire chirp pulses with a
        \ac{WURST}\cite{ODell2013}
        amplitude envelope, with a target flip angle $\beta = \ang{20}$.
        Each saltire pulse
        had a bandwidth of \qty{10}{\kilo\hertz},
        a duration of \qty{25}{\milli\second},
        and a power of \qty{280}{\micro\watt}.
        Hard pulses
        had a power of \qty{31.537}{\watt},
        with the duration of the $\nicefrac{\pi}{2}$ pulse being \qty{15}{\micro\second}.
        $G_1$ and $G_2$ were gradients for coherence order selection.
        Each comprised a 100-point sine shape profile, and lasted
        \qty{1}{\milli\second}.
        $G_3$ was a rectangular weak gradient applied during the PSYCHE
        element, with a duration of \qty{52}{\milli\second}.
        The gradeint strengths as a percentage of the maximum permissible
        z-gradient were, respectively 31\%, 47\%, 1.6\%.
        The phase cycling scheme used was:
        $\Phi_1: 2 \times (\ang{0}, \ang{180})$;
        $\Phi_2: 4 \times \ang{0}$;
        $\Phi_3: 2 \times \ang{0}, 2 \times \ang{90}$;
        $\Phi_{\text{rx}}: \ang{0}, \ang{180}, \ang{180}, \ang{0}$.
    }
    \label{fig:psyche}
\end{figure}

\begin{figure}
    \centering
    \includegraphics{tse_psyche_pulse_sequence/tse_psyche_pulse_sequence.pdf}
    \caption[
    \acs{TSE-PSYCHE} pulse sequence used for the acquisition of dexamethasone data.
    ]{
        \acs{TSE-PSYCHE} pulse sequence used for the acquisition of dexamethasone
        data (Figure \ref{fig:dexamethasone-cupid}.a).
        Delays:
        $d_1$ (relaxation delay): \qty{2}{\second},
        $d_{16}$: (gradient recovery delay): \qty{200}{\micro\second},
        $\tau_a$: \qty{5}{\milli\second} ($= \nicefrac{1}{4
        f_{\text{sw}}^{(1)}}$).
        The hard $\nicefrac{\pi}{2}$ pulse had a duration of
        \qty{12}{\micro\second}, and a power of \qty{24}{\watt}.
        The two $\pi$ pulses were unidirectional frequency-swept (chirped) pulses,
        with the first pulse sweeping from low to high frequencies, and the second
        pulse sweeping from high to low. These each had a \acs{WURST} amplitude
        envelope, lasted a duration of \qty{40}{\milli\second}, and had a power
        of $\qty{11.05}{\milli\watt}$.
        The \ac{PSYCHE} element had a target flip angle $\beta = \ang{15}$, and
        featured two saltire chirp pulses. Both saltire pulses had a
        \ac{WURST} amplitude envelope, a duration of \qty{15}{\milli\second},
        and a power of
        \qty{1.28}{\milli\watt}.
        $g_1$, $g_3$ and $g_5$ were gradients for coherence order selection.
        Each comprised a 100-point sine profile, and lasted
        \qty{1}{\milli\second}. $g_2$, $g_4$ and $g_6$ were weak rectangular gradients
        which were applied at the same time as the chirped pulses.
        The magnitudes of gradients $g_1$ to  $g_6$ as a percentage of the
        maximum permitted gradient were, respectively:
        49\%, 2\%, 35\%, 3\%, 77\%, 2\%.
        The phase cycling scheme used was:
        $\Phi_1: 8 \times \ang{0}$;
        $\Phi_2: 2 \times (2 \times \ang{0}, 2 \times \ang{180})$;
        $\Phi_3: 2 \times (\ang{0}, \ang{90}), 2 \times (\ang{180}, \ang{270})$;
        $\Phi_4: 8 \times \ang{0}$;
        $\Phi_{\text{rx}}: 4 \times (\ang{0}, \ang{180})$.
    }
    \label{fig:tse_psyche}
\end{figure}
