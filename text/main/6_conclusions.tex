\chapter{Conclusions and Future Work}
\label{chap:conclusions}

\section{Conclusions}
This thesis has focussed on the use of parametric estimation as a means of
extracting quantitative information from \ac{NMR} \acp{FID}. The initial
motivation for the work arose from an interest in developing a technique
which could be applied to \ac{2DJ} datasets, facilitating the generation of broadband
homodecoupled \ac{NMR} spectra with desirable characteristics.
To achieve this, the \ac{MMEMPM}, a \ac{2D} extension of the original \ac{MPM},
was proposed as a suitable estimation routine for considering \ac{2DJ} datasets
in a holistic fashion.
However, initial evaluations of results generated by the \ac{MPM} on
\ac{1D} \acp{FID} indicated that a particular flaw frequently arose: the phases
of oscillators in the estimated model were commonly inconsistent with
expectations based on the data structure.
For this reason, a routine was developed which used the result of the
\ac{MPM} as the initial guess of an iterative \ac{NLP} algorithm; the fidelity
to be optimised included the variance of oscillator phases in order to overcome
the undesirable phase behaviour.
Through a number of examples, it has been shown that improved parameter
estimates can be obtained relative to the \ac{MPM} isolation.
An even more robust means of estimation is possible when routines which
incorporate large amounts of user-provided information are used, such as
\ac{AMARES}. However, the uptake of these methods is minimal in \ac{NMR}, due to
the impracticality in supplying all the information required. The routine
described in this thesis aims to be a compromise between the \ac{MPM},
requiring no user information, and those like \ac{AMARES}.

To alleviate the high computational burden of the proposed method,
% \,---\,the
% most noteworthy aspects being determining the \ac{SVD} of large data matrices, and
% computing Hessian of the \ac{NLP} fidelity\,---\,
a frequency-filtration procedure has been developed. The filtration method
produces sub-\acp{FID} with reduced numbers of both constituent signals and datapoints,
breaking the estimation problem down into a number of smaller-scale ones;
drastic reductions in both \ac{CPU} work and \ac{RAM} usage are possible by
doing this.
Furthermore, data filtration enables the user to ignore spectral regions
that are not of interest or simply too crowded for meaningful information to be
obtained. A specification of the regions of interest is the primary
piece of information that must be supplied manually by the user in order to
apply the estimation routine.
Work which hasn't been discussed in this thesis was carried out in an attempt to
automate this process, though with minimal success\footnote{
    The devised automation method was based on the concept of classifying
    points which belong to the spectral baseline, as employed in baseline
    correction methods\cite{Dietrich1991}. Any section of the spectrum which
    comprised a sufficiently large number of consecutive points which were
    classified as ``non-baseline'' was deemed to be a region of interest. Alas,
    this approach proved to be temperamental, with considerable tweaking
    of hyperparameters necessary to yield reasonable results. For this reason,
    the idea was discarded.
}. Because of this\,---\,alongside the requirement to sometimes specify a
prediction of the model order when the \ac{MDL} performs inadequately\,---\,the
routine is not fully automated; some user intervention is required to run it.

Impressive parametrisations of hypercomplex \ac{2DJ} \acp{FID} were achieved using
the estimation routine, which forms a part of \ac{CUPID}, a new protocol that
is able to generate pure shift spectra featuring no loss of signal (\textit{cf.}
``chunking'' methods), and peaks with sharp absorption Lorentzian lineshapes
(\textit{cf.} the classic \ac{2DJ} shear-and-project approach).
Furthermore, through a knowledge of the signal frequencies in both dimensions
of the dataset, \ac{CUPID} can decompose \ac{1D} spectra into their constituent
multiplet structures. Acquiring the information that \ac{CUPID} can generate
with a simple \ac{2DJ} dataset usually requires bespoke \ac{3D} pulse sequences
which have very large run-times.

Beyond to the original goal of \ac{2DJ} estimation, two other applications
have been developed and presented. The first is an alternative means for
determining valuable information about molecular species, including the $T_1$
and $T_2$ times of spins, and the diffusion coefficients of molecules, via
datasets which comprise a series of \acp{FID} with varying amplitudes. Whereas
typical univariate
approaches for analysing these datasets involve fitting single datapoints in
frequency space, the showcased method instead aims to gleam the
information from each signal explicitly, in order to overcome the aggregating
effect frequently encountered due to peak overlap. While the method works
admirably,
it couldn't be shown to perform noticeably better than other techniques; in
cases where there is severe signal crowding, the difficulty/impossibility of
resolving each component leads to similar signal aggregation issues.
In these circumstances, the use of a pure shift element in
combination with the relevant pulse sequence, as exemplified by the
\ac{3D} \ac{PSYCHE}-i\ac{DOSY} pulse sequence\cite{Foroozandeh2016}, is likely
the best course of action for resolving crowded signals (assuming J-couplings
are the cause of said crowding).

The last application discussed in this work involves generating ultra-broadband
\ac{NMR} spectra from an experiment involving excitation by a single chirp
pulse. With appropriate processing, where each signal is estimated using the
\ac{MPM}, and appropriately back-propagating it based on its frequency, phased
spectra with flat baselines are achievable.
This work is fairly nascent, and while the initial results presented here show
promise, the method is yet to be applied to datasets of greater interest. If
further results indicate the method is effective, this could lead to improved
sensitivity for ultra-broadband spectra compared with prominent pulse sequences
like \ac{CHORUS}.

The software package \ac{EsPy} has been developed to facilitate use of the
procedures described in this thesis. The package's \ac{API} follows a
straightforward object-oriented paradigm, which should make it easily
accessible to all members of the \ac{NMR} community that have experience with
scientific computing using \Python\!. Furthermore, the availability of an
accompanying \ac{GUI} widens the accessibility of the package further, meaning
\ac{EsPy} can be used without writing a single line of code.

It is important for an \ac{NMR} practitioner interested in applying
parametric estimation to appreciate its limitations, as well as the
benefits that it can offer. Most notably, an understanding is needed of when
meaningful information can be extracted from a given dataset.
Datasets which abide by the ``Goldilocks principle''\,---\,being neither too
simple nor too complex \,---\,are suitable candidates for analysis with
parametric estimation.
If a dataset is very simplistic, featuring well-separated
spectral peaks with high \ac{SNR}, there is unlikely to be much information
to be gained through the application of estimation that cannot be acquired via
basic integration and peak-picking.
Conversely, if the dataset features many signals with incredibly similar
frequencies, it is possible that there simply is not enough
information to accurately disentangle all of the individual signal
contributions reliably.
Despite this constraint, it has hopefully been shown that \ac{NMR} data
estimation is a valuable pursuit; it can often provide richer information than
that which is typically available with the conventional \ac{FT} method, and it
opens the way to many fruitful applications which can enhance the value of the
\ac{NMR} experiment.

\section{Future Work}
\label{sec:future-work}
Any future work related to this project would be centered around extending and
improving the \ac{EsPy} package. Some possible pursuits include the following:

\paragraph{Improving performance}
Improvements in the speed of the estimation routine
could be realised if the most computationally demanding parts of it were
written in a low-level compiled language like C/C++. This may not
be the case for the \ac{MPM} and \ac{MMEMPM}; the majority of time running
these routines involves \ac{SVD}, with \textsc{NumPy}'s implementation calling
well-optimised routines from the \textsc{LAPACK} and \textsc{ARPACK} software
packages. However, the \ac{NLP} routine could
benefit from significant improvements if the current \Python implementation
were ported to one of the aforementioned languages.

\paragraph{A general-purpose platform}
Thinking further afield from the specific estimation routine considered in this
work, the \ac{EsPy} package provides a large number of useful features which
would be applicable to the estimation using any conceived method. This includes
functionality to import data, pre-process data, and inspect the result of an
estimation routine through parameter tables and figures.
Incorporating other estimation methods into the software would therefore be
rather straightforward, such that \ac{EsPy} could become a general-purpose
platform for using and comparing the different methods.

\paragraph{\ac{2D} and \ac{3D} datasets}
Another potential future venture would be to extend the routine for the
consideration of multidimensional datasets that comprise amplitude- or
phase-modulated pairings.
As shown in \cref{chap:cupid}, the routine performs capably on
hypercomplex \ac{2D} datasets, so provided appropriate data treatment is
applied, general \ac{2D} datasets should be well within the scope of
\ac{EsPy}.
To achieve \ac{3D} estimation, it would be necessary to
make use of a \ac{3D} equivalent of the \ac{MMEMPM}. Such a technique exists,
and is used principally for sensing applications, in which the direction (i.e.
azimuth and elevation angles) as well as the frequency of waves arriving at an
antenna are sought\cite{Yilmazer2006}.
However, the computational burden required would likely be too high, both
in terms of \ac{CPU} usage and memory requirements, for the routine to be
practicable beyond the simplest \ac{3D} datasets made of few datapoints and
constituent signals.

\ac{2DJ} datasets are rather anomalous among multidimensional datasets in
that they have very densely populated indirect dimensions, due to the chemical
shift evolution not occurring in $\tone$. For this reason, it
is not necessary to be concerned about filtering the data in the indirect
dimension. However, for experiments like \ac{HSQC}, where chemical shift
evolution occurs in both dimensions, it would be desirable to filter
the data in both dimensions.
While the filtering procedure presented works well on direct-dimension
\acp{FID}, which have usually decayed to noise at the end
of acquisition, indirect-dimension \acp{FID} are often heavily truncated,
usually as a time-saving measure. The \ac{FT} of such signals without any
treatment would produce spectra with considerable truncation artefacts;
attempting to filter would lead to unusable sub-\acp{FID} due to the influence
of these artefacts.

Treating truncated datasets could possibly be handled in a few ways,
beyond running the experiment with a larger number of indirect-dimension
increments. The first option would be to propagate the \ac{FID} further in time
using \ac{LP}. Another option would be to apply apodisation in order to reshape
the indirect \acp{FID}, and remove truncation artefacts.
Exponential apodisation would lead to spectra with broader lineshapes, such
that wider spectral regions would need to be selected; furthermore the
resolution of the data would be decreased.
Resolution enhancement methods like sine-bell apodisation can
produce \acp{FID} without truncation artefacts and with good resolution.
However, applying a non-exponential weighting to the
dataset would render it incompatible with the estimation routine in its
current form; a modified routine with a suitable model would need to
be implemented.

\paragraph{``\ac{CUPID}-\ac{DOSY}''}
The \ac{PSYCHE}-i\ac{DOSY} experiment offers better signal resolution to
diffusion \ac{NMR} datasets.
A similar \ac{3D} pulse sequence could be developed
which instead produces a series of \ac{2DJ} datasets whose amplitudes are
attenuated though diffusion. With such a dataset, each \ac{2DJ} \ac{FID} could
be estimated using a method analogous to that for \ac{1D} data, presented in
\cref{subsec:seq-method}. After estimation, each \ac{2DJ} \ac{FID} increment
could then be recast as a pure shift spectrum via the \ang{-45} signal. In
effect, this procedure would be an extension of \ac{CUPID} for a series of
inter-related \ac{2DJ} spectra.

\paragraph{Incorporating constraints into the \ac{NLP} routine}
The estimation routine in its current form is designed to require as little
user input as possible while producing faithful parameter estimates. However,
in particularly challenging circumstances, most notably when
there is considerable overlap between numerous signals, the inclusion of
oscillator phase variance alone can be insufficient to produce estimates which
closely agree with known features of the data. When this is the case, it would
be useful to enable users to specify additional knowledge, incorporated into
the routine as regularising terms, \emph{after} the initial estimation has been
performed. This concept, while similar to \ac{AMARES}, differs
in that \ac{AMARES} requires very large quantities or prior knowledge
\emph{before} estimation. A lot of the heavy lifting towards an accurate
parameter estimate could be achieved using phase variance-regularised \ac{NLP},
with the user subsequently indicating erroneous features.

Take the cyclosporin A result (\cref{fig:cyclosporin}) as an example. As
discussed already, due to severe signal overlap, the assigned oscillators
related to spin (E), while at the correct frequencies, do not have appropriate
amplitudes for a dq multiplet structure. As such, re-running \ac{NLP} with a
new fidelity of
\[
    \underbrace{\FphithY}_{
        \text{\cref{eq:fidelity-phasevar}}
    }+ \Var(
        a_{\text{E}1},
        \tfrac{1}{3} a_{\text{E}2},
        a_{\text{E}3},
        \tfrac{1}{3} a_{\text{E}4},
        \tfrac{1}{3} a_{\text{E}5},
        a_{\text{E}6},
        \tfrac{1}{3} a_{\text{E}7},
        a_{\text{E}8}
    )
\]
would likely lead to an improved result.
$\lbrace \text{E}1, \cdots, \text{E}8 \rbrace \subset \lbrace 1, \cdots, M \rbrace$ are the
indices of the oscillators corresponding to spin (E), i.e. the green
oscillators in the \cref{fig:cyclosporin}. Similar terms could be included
for spins (D) and (F) as well.
