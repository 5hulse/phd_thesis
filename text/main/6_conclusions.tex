\chapter{Conclusions and Future Work}
\label{chap:conclusions}

\section{Conclusions}
This work has focussed on the use of parametric estimation as a means of
extracting quantitative information from \ac{NMR} \acp{FID}. The initial
motivation for it arose due to an interest in developing a technique
which could analyse \ac{2DJ} datasets, facilitating the generation of broadband
homodecoupled \ac{NMR} spectra with desirable characteristics.
To achieve this, the \ac{MMEMPM}, a \ac{2D} extension of the original \ac{MPM},
was proposed as a suitable estimation routine for considering \ac{2DJ} datasets
in a holistic fashion.
However, initial evaluations of results generated by the \ac{MPM} on
\ac{1D} \acp{FID} indicated that a particular flaw frequently arose: the phases
of oscillators in the estimated model were commonly inconsistent with
expectations based on the data structure.
For this reason, a routine was developed which used the result of the
\ac{MPM} as the initial guess of \iac{NLP} algorithm; the \ac{NLP} algorithm
included the variance of oscillator phases in its fidelity to overcome the
undesirable phase behaviour.
Through a number of examples, it has been shown that improved parameter
estimates can be obtained relative to the \ac{MPM} isolation.
It is expected that improved results could be obtained when iterative routines
which incorporate large amounts of user-provided information are used, such as
\ac{AMARES}. The uptake of these methods is minimal in \ac{NMR} however, due to
the impracticality in supplying the information required. The routine described
in this thesis aims to be a compromise between the \ac{MPM}, requiring no user
information, and those like \ac{AMARES}.

To alleviate the high computational burden of the proposed method\,---\,the
most noteworthy aspects being determining the \ac{SVD} of large matrices and
computing Hessian of the \ac{NLP} fidelity\,---\,a frequency-filtration
technique has been incorporated. This produces sub-\acp{FID} with reduced
numbers of both constituent signals and datapoints, breaking down the
estimation problem into a number of smaller-scale ones.
Drastic reductions in both \ac{CPU} work and \ac{RAM} usage are possible by
doing this.
Furthermore, data filtration enables the user to neglect spectral regions
that are not of interest/too crowded to realistically yield meaningful
information from. A specification of the regions to estimate is the primary
piece of information that must be supplied manually by the user.
Work which hasn't been discussed in this thesis was carried out in an attempt to
automate this, though with minimal success\footnote{
    The approach to automate the determination of spectral regions was based on
    the concept of classifying points which belong to the spectral
    baselines\cite{Dietrich1991}; any section of the spectrum which comprised a
    sufficiently large number of consecutive points which were not classified
    as baseline was deemed to be a region of interest. Alas, this approach
    proved to be rather temperamental, with considerable tweaking of
    hyperparameters necessary to yield reasonable results. For this reason, the
    concept was discarded.
}.

Impressive parametrisations of hypercomplex \ac{2DJ} \acp{FID} were achieved using
the estimation routine, leading to \ac{CUPID}, which is able generate pure
shift spectra without the loss of signal associated with experimental
``chunking'' methods, and featuring peaks with sharp absorption Lorentzian
lineshapes.
Furthermore, \ac{CUPID} is able to provide additional insights, such as
harnessing the information from \ac{2DJ} estimation to decompose \ac{1D}
spectra into their constituent multiplet structures. Acquiring the information
that \ac{CUPID} can generate with a simple \ac{2DJ} dataset usually requires
bespoke \ac{3D} pulse sequences with a very large associated run-times.

Beyond to the original goal of \ac{2DJ} estimation, two other applications
have been developed and presented here. The first is an alternative means for
determining valuable information about molecular species ($T_1$ and  $T_2$
times of spins, and diffusion coefficients) via datasets which comprise a series
of \acp{FID} whose amplitudes vary. Whereas typical univariate
approaches to analysing these datasets involve fitting single datapoints in
frequency space, the method showcased instead aims to gleam the
information for each signal explicitly, to overcome the aggregating effect
frequently encountered due to signal overlap. While the method works admirably,
it couldn't be shown to perform noticeably better than other techniques; in
cases where there is severe signal crowding, the difficulty/impossibility of
resolving each component leads to similar issues involving signal aggregation.

A second application featuring \ac{1D} estimation involves generating broadband
\ac{NMR} spectra from an experiment involving excitation by a single chirp
pulse. With appropriate processing, involving estimating each signal using the
\ac{MPM}, and appropriately back-propagating it based on its frequency, phase
spectra with flat baselines are achievable.
This work is fairly nascent, and while the initial results presented here show
promise, there is yet to be applied to datasets of greater interest. If
further results indicate the method is effective, this could lead to improved
sensitivity for ultra-broadband spectra, when compared with current
state-of-the-art methods like \ac{CHORUS}.

The software package \ac{EsPy} has been developed to facilitate use of the methods
described in this thesis. The package's \ac{API} follows a straightforward
object-oriented paradigm, which should make it easily accessible to all
members of the \ac{NMR} community that have experience of scientific
computing with \Python\!. Furthermore, the availability of an accompanying \ac{GUI}
widens to accessibility of the package further, meaning \ac{EsPy} can be used
without writing a single line of code. The package has been heavily documented
too; this is a crucial element for any user-facing software which is often
lacking, especially in academic contexts.

%%% Final bit
It has hopefully been shown that attempting to solve the inverse problem of
\ac{NMR} data estimation is a valuable pursuit; it provides richer information
that that which is typically available with the conventional \ac{FT} method,
and it opens up many fruitful applications which can enhance the value that
\ac{NMR} can offer to practitioners in many scientific disciplines.


\section{Future Work}
\label{sec:future-work}
Any future work related to this project would be centered around extending and
improving the \ac{EsPy} package. Some possible pursuits include the following:

\paragraph{Improving performance}
Improvements in the speed of the estimation
could be realised if the most computationally demanding parts of it were
written in a low-level compiled language like C++ or \textsc{Rust}. This may not
be the case for the \ac{MPM} and \ac{MMEMPM}; the majority of time running
these routines involves \ac{SVD}, with \textsc{NumPy}'s implementation calling
well-optimised routines from the \textsc{LAPACK} and \textsc{ARPACK} software
packages. However, in its current state, the \ac{NLP} routine could well be
sped up considerably if the current \Python implementation were ported to one
of the aforementioned languages.

\paragraph{A more general platform}
Thinking further afield from the specific estimation routine considered in this
work, the \ac{EsPy} package provides a large number of useful features which
would be applicable to the estimation using any conceived method. The includes
functionality to import data, pre-process data, and inspect the result of an
estimation routine through parameter tables and figures.
Incorporating other estimation routines into the software would therefore be
rather straightforward, such that \ac{EsPy} could become a general-purpose
platform for comparing different methods.

\paragraph{\ac{2D} and \ac{3D} datasets}
Another potential future venture would be to extend to routine for the
consideration of other \ac{2D} datasets, such as those that comprise
amplitude- or phase-modulated pairings, as well as \ac{3D} datasets,
including those acquired from ``triple-resonance'' experiments which are
popular in the biological \ac{NMR} community\cite[Section 7.4]{Cavanagh2007}.
As shown in
\cref{chap:cupid}, the method is capable of performing well on hypercomplex
\ac{2D} datasets. In order to achieve \ac{3D} estimation, it would be necessary to
make use of a \ac{3D} equivalent of the \ac{MMEMPM}. Such a technique exists,
and is used principally for sensing applications, in which the direction (i.e.
azimuth and elevation angles) as well as the frequency of waves arriving at an
antenna are sought\cite{Yilmazer2006}. However, there is a key issue with
multidimensional \ac{NMR} signals which would likely hamper the method outlined
in this thesis from being effective. \ac{2DJ} datasets are rather anomalous in
that they have very densely populated indirect dimensions. For this reason, it
is not necessary to be concerned about filtering the data in the indirect
dimension. However, for most \ac{2D} datasets, it would be desirable to filter
the data in both dimensions, as both will generally be sparsely populated.
While the filtering procedure presented works well on direct-dimension
\acp{FID}, which have usually decayed to noise at the end
of acquisition, indirect-dimension \acp{FID} are often truncated. The \ac{FT}
of such signals without any treatment would produce spectra with considerable
truncation artefacts; filtering such spectra would incorporate undesirable
artefacts into a filtered sub-\ac{FID}, rendering it worthless.
Compensating for the truncation could be achieved, by applying exponential
apodisation prior to \ac{FT}. However, this would then lead to spectra with
broader lineshapes, such that wider spectral regions would need to be selected,
and the resolution of the data would be decreased.
Dealing with
truncated signals could possibly be handled in one of two ways, beyond running
the experiment to acquire the data with a huge number of increments. One
option would be to propagate the \ac{FID} further in time using \ac{LP}.
Another would be to apply conventional apodisation, such as a sine-bell
function to the \ac{FID}, producing a \ac{FID} without truncation artefacts and
acceptable resolution. However, applying a non-exponential weighting to the
dataset however render the data incompatible with the estimation routine in its
current form, such that a modified routine with a suitable model would need to
be implemented. On to of issues with data applicability, for \ac{3D}
estimation the computational burden required would also likely be too high for
the routine to be practicable beyond the simplest datasets with few points and
minimal numbers of signals.

\paragraph{Incorporating constraints into the \ac{NLP} routine}
The estimation routine in its current form is designed to require as little
user input as possible while producing faithful parameter estimates. However,
in particularly challenging circumstances, most notably when
there is extreme signal overlap, the inclusion of oscillator phase variance
alone can be insufficient to produce estimates which closely agree with the
experiment. When this is the case, it would be useful to enable users to
specify additional knowledge, incorporated into the routine as additional
regularising terms, \emph{after} the initial estimation has been performed.
This concept, while similar to \ac{VARPRO} and \ac{AMARES}, differs in that
these require very large quantities or prior knowledge \emph{before}
estimation. A lot of the heavy lifting towards an accurate parameter estimate
could be achieved using phase variance-regularised \ac{NLP}, with the user
indicating erroneous features subsequently.

Take the cyclosporin A result (\cref{fig:cyclosporin}) as an example. As
discussed already, due to severe signal overlap, the assigned oscillators
related to spin (E), while at the correct frequencies, do not have appropriate
amplitudes for a dq multiplet structure. As such, re-running \ac{NLP}, with a
new fidelity of
\[
    \FphithY + \Var(
        a_{\text{E}1},
        \tfrac{1}{3} a_{\text{E}2},
        a_{\text{E}3},
        \tfrac{1}{3} a_{\text{E}4},
        \tfrac{1}{3} a_{\text{E}5},
        a_{\text{E}6},
        \tfrac{1}{3} a_{\text{E}7},
        a_{\text{E}8}
    )
\]
would likely lead to an improved result.
$\lbrace \text{E}1, \cdots, \text{E}8 \rbrace \subset \lbrace 1, \cdots, M \rbrace$ are the
indices of the oscillators corresponding to spin (E), i.e. the green
oscillators in the figure.
